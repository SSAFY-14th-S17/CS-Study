# 데드락 (Deadlock, 교착상태)
![](/document/images/deadlock.png)

> ### 둘 이상의 프로세스가 다른 프로세스가 점유하고 있는 자원을 서로 기다릴 때 _무한 대기_에 빠지는 상황

---

## 1. 데드락의 발생 4대 조건
### 1. 상호 배제
- 한 번에 프로세스 하나만 해당 자원을 사용할 수 있다. 
- 사용 중인 자원을 다른 프로세스가 사용하려면 요청한 자원이 해제될 때까지 기다려야 한다. 

### 2. 점유 대기 
- 자원을 최소한 하나 보유하고, 다른 프로세스에 할당된 자원을 점유하기 위해 대기하는 프로세스가 존재해야 한다. 

### 3. 비선점 
- 이미 할당된 자원을 강제로 빼앗을 수 없다.

### 4. 순환 대기 
- 대기 프로세스의 집합이 순환 형태로 자원을 대기하고 있어야 한다. 

> #### 위 4가지 조건을 모두 만족할 시, 데드락이 발생할 수 있다.


---

## 2. 데드락 해결법
크게 3가지로 나눌 수 있다. 

1. 데드락이 발생하지 않도록 **예방**하기 
2. 데드락 발생 가능성을 인정하면서도 적절하게 **회피**하기 
3. 데드락 발생을 허용하지만 데드락을 **탐지**하여, 데드락에서 **회복**하기 

---

### 데드락 예방 
#### 애초에 교착 상태가 발생하지 않도록 하는 방식 
데드락 발생 4대 조건 중 **하나를 만족시키지 않는 방법**으로 예방한다. 

1. **상호 배제**를 없애보면
- **한 번에 여러 프로세스가 공유 자원을 사용할 수 있게 한다**. 
   - 추후 동기화 관련 문제가 발생할 수 있다.
   - 모든 자원을 프로세스들이 공유하게 만드는 것은 **현실적으로 불가능**

2. **점유 대기**를 없애보면
- 프로세스 실행에 필요한 모든 자원을 **한꺼번에 요구**하고 **허용할 때까지 작업을 보류**해서, 나중에 또 다른 자원을 점유하기 위한 대기 조건을 성립하지 않도록 한다. 
   - 자원 분배의 효율성이 매우 떨어진다. 

3. **비선점**을 없애보면 
- 선점의 허용은 데드락을 예방하는 가장 현실적인 방법 
- 하지만 선점이 가능한 자원에 한해 효과적이나, **모든 자원이 선점이 가능하지 않다**. 

4. **순환 대기**를 없애보면
- 자원을 순환 형태로 대기하지 않도록 **일정한 한 쪽 방향으로만** 자원을 요구할 수 있도록 한다. 
   - 모든 자원에 우선 순위를 두면 가능한 방법이다. 

> **결론**
데드락을 **예방**하는 방법은 **자원의 낭비가 극심**하기 때문에 좋은 방법이 아니다. 

---

### 데드락 회피 
#### 한정된 자원을 무분별하게 할당해서 데드락이 발생했다고 간주 
즉, **배분할 수 있는 자원의 양을 고려**해서 **데드락이 발생하지 않을 만큼만 자원을 배분**하는 방식 

#### 안전 순서열 
- 데드락 없이 안전하게 모든 프로세스들에 자원을 할당할 수 있게 하는 순서

#### 안전 상태 
- 데드락 없이 모든 프로세스가 자원을 할당 받고 종료될 수 있는 상태 
- 안전 순서열이 있는 상태

#### 불안전 상태 
- 데드락이 발생할 수도 있는 상태 
- 안전 순서열이 없는 상태 

> **결론** 
데드락 **회피**는 **항시 안전 상태를 유지하며 자원을 할당하는 방식**이다. 

---

### 데드락 탐지 및 회복 
#### 프로세스가 자원을 요구하면 일단 할당 후 교착 상태가 탐지되면 회복하는 방식 

- **자원 선점을 통한 회복**
   - 데드락이 해결될 때까지 한 프로세스 씩 자원을 몰아주는 방식 

- **프로세스 강제 종료를 통한 회복**
   - 데드락에 놓인 프로세스 모두를 강제 종료하는 방식 
      - 단점: 작업 내역을 잃을 위험성 존재
   
   - 데드락이 해결될 때까지 한 프로세스 씩 강제 종료하는 방식
      - 단점: 한 프로세스 종료하고 데드락이 해결되었는지 확인하는작업을 반복해야 한다. -> 오버헤드 발생 

