# 동기화 도구
다중 프로그래밍 환경에서는 여러 프로세스나 스레드가 메모리, 변수, 파일과 같은 공유 자원에 동시 접근하려고 하는 **경쟁 상태(Race Condition)가 일어나 데이터의 일관성을 해칠 수 있다.** 이 문제를 해결하기 위해서 임계 구역이라는 개념이 도입됐고 이를 해결하기 위한 주요 동기화 도구로 **뮤텍스**와 **세마포어**가 사용되고 있다.

## 뮤텍스 (Mutex)

![mutex&semaphore_1.png](/document/images/mutex&semaphore_1.png)

뮤텍스란 Mutual Exclusion(상호배제)의 줄임말로 ***오직 하나의 프로세스/스레드만이** 특정 시점에 공유 자원에 접근할 수 있도록 보장*한다.

한 프로세스/스레드에 의해 소유될 수 있는 **Key를 기반으로 한 상호배제 기법**으로, Key에 해당하는 어떤 객체(Object)가 있고 이 객체를 소유한 프로세스/스레드 만이 공유자원에 접근할 수 있게 한다.

동작 방식:

 1. `lock()` (잠금): 스레드가 **공유 자원을 사용하기 전에 lock을 시도**합니다.
 2. 만약 'Key'가 사용 가능하면(unlocked 상태), **스레드는 Key를 획득하고 locked 상태로 바꾼 뒤 공유 자원에 접근**합니다.
 3. 만약 *다른 스레드가 이미 'Key'를 쥐고 있다면(locked 상태)*, 이 **스레드는 'Key'가 반납될 때까지(즉, unlocked 될 때까지) 대기(Block)** 합니다.
 4. `unlock()` (해제): **공유 자원 사용을 마친 스레드는 반드시 unlock을 통해 'Key'를 반납**해야 합니다.

특징
 - 이진(Binary) 상태: 상태가 locked 또는 unlocked 두 가지로만 나타낼 수 있다.
 - 소유권(Ownership): **lock을 건 스레드만이 unlock을 할 수 있다.**

> **🚽 화장실 비유 🪠**  
> 열쇠가 하나뿐인 1인용 화장실과 같다. 화장실에 들어가려면 **카운터에서 유일한 열쇠(lock)** 를 얻어야 한다.
> 한 사람이 열쇠를 가지고 들어가면 다른 사람들은 그 사람이 나와서 **열쇠를 반납(unlock)할 때까지 기다려야 한다.**


## 세마포어 (Semaphore)

![mutex&semaphore_2.png](/document/images/mutex&semaphore_2.png)

세마포어란 **특정 개수(N)의 동일한 자원에 대해 접근할 수 있는 스레드의 수를 제어하는 카운터**이다.  
사용하고 있는 프로세스/스레드의 수를 공통으로 관리하는 하나의 값을 이용해 상호배제를 달성할 수 있다.

동작 방식:
 1. `wait()` (P 연산): 스레드가 자원을 사용하기 위해 wait를 호출한다.
 2. 세마포어 카운터 값을 1 감소시킨다 (counter--)
 3. 만약 카운터 값이 0보다 작아지면 (사용 가능한 자원이 없으면), 스레드는 자원이 생길 때까지 대기(Block)한다.
 4. `signal()` (V 연산): 스레드가 자원 사용을 마치면 signal을 호출한다.
 5. 세마포어 카운터 값을 1 증가시킨다 (counter++)
 6. 만약 대기 중인 스레드가 있다면, 그중 하나를 깨워서 자원을 할당받도록 한다.

특징
 - 정수(Integer) 상태: 0 이상의 정수 값을 가질 수 있다. 이 값은 '사용 가능한 자원의 수'를 의미한다.
 - 소유권 개념 없음: wait를 호출한 스레드와 signal을 호출한 스레드가 서로 달라도 된다.
 
> **🚽 화장실 비유 🪠**  
> 여러 칸이 있는 화장실과 같다. 입구에는 **비어있는 칸의 수를 표시하는 전광판(카운터)** 이 있어서 화장실에 들어가려는 사람은 **전광판의 숫자를 1 감소**시키고(wait 또는 P 연산), **나올 때는 숫자를 1 증가**시킨다(signal 또는 V 연산). 만약 **빈칸이 없다면(카운터가 0), 누군가 나올 때까지 기다려야한다.**

### 뮤텍스 vs 세마포어
| 특징 | 뮤텍스 (Mutex)                             | 세마포어 (Semaphore)                 |
|---|-----------------------------------------|----------------------------------|
| 목적 | **상호 배제**                               | **자원 접근 제어**                     |
| 핵심| 임계 영역에 **단 하나**의 프로세스/스레드만 허용           | 정해진 **N개의** 프로세스/스레드 허용          |
| 상태 | 	**이진(Binary)** (Locked / Unlocked)     | **정수(Integer)** (사용 가능한 자원의 수)   |
| 소유권 | **소유자만** 해제 가능 (Lock을 건 스레드만 Unlock 가능) | **소유권 개념 없음** (누구나 Signal(V) 가능) |
| 비유 | 화장실 열쇠 (1개)                             | 휴게소 화장실 (전광판)                    |
