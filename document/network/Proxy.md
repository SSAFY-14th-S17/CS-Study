# 프록시 (Proxy)

## 프록시(Proxy)란?
**프록시(Proxy)** 는 '대리인'을 의미한다. 네트워크 아키텍처에서 프록시 서버는 **클라이언트와 최종 목적지 서버 사이의 중간 다리 역할**을 수행하며 모든 통신을 대리한다.

단순히 요청을 전달만 하는 것이 아니라 이 중간 지점에서 **다양한 부가 기능을 수행하며 시스템 전체의 보안, 성능, 효율성을 높이는 핵심 컴포넌트**로 활약한다.

---

## 핵심 작동 원리

1.  **Request Interception (요청 가로채기):** 클라이언트의 HTTP 요청 메시지는 원래 목적지 서버가 아닌 **프록시 서버**로 향하게 된다. 이를 위해 클라이언트는 프록시 서버의 주소를 미리 알고 있도록 설정되어야 한다.
2.  **Packet Re-construction (패킷 재구성):** 프록시 서버는 클라이언트로부터 받은 요청 패킷을 해석(Parsing)하게 된다. HTTP 헤더와 바디를 분석하여 요청의 유효성을 검사하고 필요한 경우 헤더 정보를 수정하거나 추가한다.
3.  **New Connection (새로운 연결 생성):** 프록시 서버는 **자신의 IP 주소를 출발지로 하여** 목적지 서버로 향하는 새로운 TCP/IP 연결을 생성한다. 바로 이 지점에서 클라이언트의 IP가 숨겨지는 **익명성**이 확보된다.
4.  **Forward & Relay (전달 및 중계):** 재구성된 요청 패킷을 목적지 서버로 전달하고 서버로부터 받은 응답(Response)을 다시 클라이언트에게 전달한다. 이 과정에서 응답 데이터를 캐싱하거나 보안 검사를 수행할 수 있다.

---

## Forward Proxy vs Reverse Proxy

![Forward Proxy](/document/images/proxy_1.png)

프록시는 배치되는 위치와 주된 목적에 따라 크게 **포워드 프록시(Forward Proxy)** 와 **리버스 프록시(Reverse Proxy)** 로 나뉜다.

### 1. Forward Proxy: 클라이언트를 위한 대리인
포워드 프록시는 **클라이언트를 위한 대리인**이다. 내부 네트워크에 있는 클라이언트가 인터넷에 접속할 때 거쳐 가는 서버로 서버는 클라이언트의 실제 IP가 아닌 포워드 프록시의 IP를 보게 된다.

* **위치:** 클라이언트와 인터넷 사이
* **목적:** 내부 클라이언트의 요청을 인터넷의 목적지 서버로 '대신' 전달
* **인지:** 클라이언트는 자신이 프록시를 사용하고 있다는 것을 **알고** 브라우저나 OS에 직접 설정해야 한다.

#### 장점
* **보안 및 익명성:** 클라이언트의 실제 IP를 숨겨주므로 인터넷 서버로부터의 직접적인 공격을 막고 익명성을 보장한다.
* **캐싱 (Caching):** 자주 요청되는 콘텐츠(이미지, 파일 등)를 프록시 서버에 저장해 둔다. 이후 동일한 요청이 오면 원 서버까지 가지 않고 캐시에서 바로 응답하여 속도를 높이고 네트워크 트래픽을 절감한다.
* **접근 제어:** 특정 웹사이트나 콘텐츠에 대한 내부 사용자의 접근을 차단하는 등 기업이나 학교 환경에서 정책을 적용하기 용이하다.

#### 단점
* **설정의 번거로움:** 사용하는 클라이언트마다 개별적으로 프록시 설정을 해줘야 한다.
* **보안 취약점:** 프록시 서버 자체는 암호화 기능을 제공하지 않는 경우가 많아 중요한 정보가 중간에 노출될 수 있다. (HTTPS는 예외)
* **속도 저하:** 모든 요청이 프록시 서버를 거쳐 가므로 서버의 성능이나 네트워크 상태에 따라 응답 속도가 느려질 수 있다.

### 2. Reverse Proxy: 서버를 위한 대리인

![Reverse Proxy](/document/images/proxy_2.png)

리버스 프록시는 **서버를 위한 대리인**이다. 인터넷의 클라이언트들이 내부 서버에 요청할 때 그 요청을 대신 받아주는 서버로 클라이언트는 자신이 실제 서버가 아닌 리버스 프록시와 통신하고 있음을 인지하지 못한다.

* **위치:** 인터넷과 내부 서버(웹 서버 등) 사이
* **목적:** 외부로부터 들어오는 요청을 받아 적절한 내부 서버로 '분배'하고 보호하는 것
* **인지:** 클라이언트는 리버스 프록시의 존재를 알지 못하며, 단일 서버의 공개 주소(예: [www.example.com](https://www.example.com))로만 접속한다.

#### 장점
* **로드 밸런싱 (Load Balancing):** 들어오는 요청을 여러 대의 내부 서버로 분산시켜 특정 서버의 과부하를 막고 서비스의 안정성과 가용성을 높인다.
* **보안 강화:** 실제 서버의 IP 주소와 아키텍처를 외부에 숨겨 DDoS와 같은 직접적인 공격으로부터 내부 시스템을 보호하는 방화벽 역할을 한다.
* **SSL 암호화 오프로딩:** 클라이언트와의 HTTPS 통신에 필요한 복잡한 암복호화 과정을 리버스 프록시가 전담한다. 이를 통해 내부 서버는 암호화 부담을 덜고 비즈니스 로직 처리에만 집중할 수 있어 성능이 향상된다.
* **중앙 집중 관리:** 여러 서버의 인증서 관리, 로깅, 접근 제어 등을 리버스 프록시 한 곳에서 통합 관리하여 효율적이다.

#### 단점
* **복잡한 구성:** 초기 설정 및 아키텍처 구성이 포워드 프록시에 비해 복잡하다.
* **단일 장애점 (SPOF):** 리버스 프록시 서버에 장애가 발생하면 해당 프록시를 통해 서비스되는 모든 내부 서버에 대한 접속이 불가능해진다. (이중화 구성 필수)
* **증가된 지연 시간:** 모든 요청이 프록시를 거치므로 약간의 지연 시간(latency)이 추가될 수 있다.

---

## 사용 목적에 따른 분류

프록시 서버가 클라이언트의 정보를 얼마나 숨겨주느냐(헤더 정보 노출 여부)에 따라 3가지 레벨로 나눌 수 있다.

### 1. Transparent Proxy (투명 프록시)
* **개념:** 클라이언트의 IP 주소를 숨기지 않고 그대로 서버에 전달하는 프록시.
* **특징:** 서버는 클라이언트가 프록시를 경유해 왔다는 사실과 클라이언트의 실제 IP를 모두 알 수 있다. (`HTTP_VIA`, `HTTP_X_FORWARDED_FOR` 헤더에 정보가 남음)
* **용도:** 익명성 보장보다는 **캐싱(속도 향상)** 이나 **웹 사이트 접근 통제(방화벽)** 목적으로 주로 사용된다.

### 2. Anonymous Proxy (익명 프록시)
* **개념:** 클라이언트의 실제 IP를 숨겨주지만 프록시를 사용 중이라는 사실은 알리는 프록시.
* **특징:** 서버는 클라이언트의 실제 IP는 알 수 없지만 접속한 대상이 프록시 서버라는 것은 인지한다.
* **용도:** 어느 정도의 익명성을 보장받고 싶을 때 사용한다.

### 3. High Anonymity Proxy / Elite Proxy (고익명 프록시)
* **개념:** 클라이언트의 IP를 완벽히 숨기고 프록시 사용 여부조차 숨기는 프록시.
* **특징:** 서버는 클라이언트가 프록시를 통하지 않고 직접 접속한 것으로 착각하게 만든다. 프록시 관련 헤더를 전혀 전송하지 않는다.
* **용도:** 가장 높은 수준의 보안과 익명성이 필요할 때 사용된다.

---

## 대표적인 오픈소스 프록시 서버

실무에서 자주 사용되는 대표적인 프록시 소프트웨어들은 다음과 같다.

### 1. Nginx (엔진엑스)
![Nginx](/document/images/proxy_3.png)
* **유형:** 주로 **리버스 프록시** 및 웹 서버
* **특징:** 비동기 이벤트 기반 구조로 **매우 높은 성능**과 적은 메모리 사용량을 자랑한다. 정적 파일 처리와 로드 밸런싱에 탁월하며 현대적인 웹 아키텍처에서 가장 널리 사용되는 프록시 서버 중 하나다.

### 2. Apache HTTP Server (아파치)
![Apache](/document/images/proxy_4.png)
* **유형:** 포워드/리버스 프록시, 웹 서버
* **특징:** 오랜 역사와 방대한 모듈 생태계를 가진 소프트웨어. `mod_proxy` 모듈을 통해 강력한 프록시 기능을 제공한다. 설정이 유연하지만 Nginx에 비해 무거운 편이다.

### 3. HAProxy
![HaProxy](/document/images/proxy_5.png)
* **유형:** TCP/HTTP **로드 밸런서** 및 프록시
* **특징:** 오직 고가용성(High Availability), 로드 밸런싱, 프록시 기능에만 집중하여 개발된 소프트웨어다. 매우 정교한 트래픽 제어가 가능하며 대규모 트래픽 처리에 적합하다.

### 4. Squid (스퀴드)
![Squid](/document/images/proxy_6.png)
* **유형:** 주로 **포워드 프록시** (캐싱 전용)
* **특징:** 웹 캐싱에 특화된 프록시 서버다. HTTP, HTTPS, FTP 등 다양한 프로토콜을 지원하며 ISP나 기업 네트워크에서 대역폭 절약과 접속 속도 향상을 위해 자주 사용된다.